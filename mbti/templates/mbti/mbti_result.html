{% extends 'MBTI/components/base.html/' %}

{% block content %}
<body>
  <div class="flex flex-col items-center justify-center text-center mx-auto p-11"> 
    <div class="w-full max-w-8xl bg-white border border-gray-300 rounded-lg shadow-md p-8 mb-6">
        <div class="flex justify-between">
            <div class="w-1/2 p-4">
                <h1>ผลลัพธ์ บุคลิกภาพของคุณ {{ user.username }}</h1>
                <br>
                {% if message %}
                <p>{{ message }}</p>  <!-- ข้อความแสดงเมื่อไม่มีข้อมูลผลลัพธ์ -->
                {% else %}
                    {% if Point %}
                        <p>คะแนนของคุณคือ: <br> {{ Point }}</p>
                    {% endif %}
                    <br>
                    {% if MBTI %}
                        <p>สรุปผลลัพธ์ MBTI ของคุณคือ: <br> {{ MBTI }}</p>
                        <br>
                        <p>คำอธิบาย: <br> {{ description }}</p>
                        <br>
                        <p>อาชีพยอดนิยมสำหรับคนไทป์ {{ MBTI }} คือ: <br> {{ careers }}</p>
                    {% endif %}
                {% endif %}
                <br>
                <h2 class="font-bold">แหล่งข้อมูลอ้างอิงที่นำมาใช้ประกอบเว็บไซต์</h2>
                <p>1. www.getrealme.com</p>
                <p>2. www.mbtionline.com/</p>
            </div>
        
            <div class="w-1/2">
                <form method="POST">
                    {% csrf_token %}
                    <!-- ตัวอย่าง HTML สำหรับ dropdown menu -->
                    <label  for="myDropdown">เลือกอาชีพ:</label>
                    <select id="myDropdown" name="career">
                        <option value="Police">ตำรวจ</option>
                        <option value="doctor">แพทย์</option>
                        <option value="engineer">วิศวกร</option>
                        <option value="soldier">ทหาร</option>
                    </select>
                    <br>
                    <label  for="myDropdown">เลือกสีผม:</label>
                    <select id="myDropdown" name="hair">
                        <option value="red hair">แดง</option>
                        <option value="black hair">ดำ</option>
                        <option value="white hair">ขาว</option>
                        <option value="yellow hair">เหลือง</option>
                    </select>
                    <br>
                    <label  for="myDropdown">เลือกสีผิว:</label>
                    <select id="myDropdown" name="skin">
                        <option value="fair skin ">ขาว</option>
                        <option value="warm skin">ขาวเหลือง</option>
                        <option value="dark skin">เข้ม</option>
                    

                    </select>
                    <br>    
                    <br>
                    <!-- <input type="text" name="prompt" id="prompt" class=" border-2 border-orange-500 bg-gray-100 rounded-lg p-1" placeholder="1boy,teacher,career,blue hair,full body"> -->
                    <button  onclick="submitForm()" class="rounded-lg shadow-xl bg-orange-200 border-orange-600 p-1 border-2">สร้าง</button>
                </form>
                
                <br>
                <div id="message"></div>
                <br>
                <div style="display: flex; justify-content: center; align-items: center;">
                    <img src="../media/ai_image/{{user.username}}.jpg" alt="{{user.username}}" style="max-width: 35%; height: auto;">
                </div>
                <br>
                <div class="result-section">
                    <button class="rounded-lg shadow-xl bg-orange-200 border-orange-600 p-1 border-2"onclick="copyURLToClipboard('{{ full_url }}')">SHARE</button>

                </div>
                <script>
                    document.getElementById('imageForm').addEventListener('submit', function(e) {
                        e.preventDefault(); // หยุดการรีเฟรชหน้าเมื่อส่งฟอร์ม
                        var formData = new FormData(this);
                    
                        // อัปเดตผู้ใช้เกี่ยวกับสถานะการโหลด
                        document.getElementById('loadingStatus').innerText = 'กำลังสร้างรูปภาพ...';
                    
                        fetch('mbti_result', {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                document.getElementById('resultImage').src = data.image_url;
                                document.getElementById('loadingStatus').innerText = 'การสร้างรูปเสร็จสิ้น!';
                            } else {
                                document.getElementById('loadingStatus').innerText = 'การสร้างรูปล้มเหลว: ' + data.error;
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            document.getElementById('loadingStatus').innerText = 'เกิดข้อผิดพลาดในการสร้างรูป';
                        });
                    });
                    document.getElementById('shareButton').addEventListener('click', function()  {
                    copyURLToClipboard('{{ full_url }}'); 
                    }); 
                </script>
                <script>
                    function copyURLToClipboard(url) {
                        navigator.clipboard.writeText(url).then(() => {
                            alert('URL copied to clipboard!');
                        }).catch(err => {
                            console.error('Failed to copy:', err);
                        });
                    }
                    function submitForm() {
                        
                        document.getElementById('message').innerText = 'กำลังสร้าง...';  // ข้อความที่จะแสดง
                    
                        }
                </script>
            </div>
        </div>
    </div>
  </div>
</body>

{% endblock %}